<!DOCTYPE html>
<html>
<head>
    <title>Debug GPS</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map { height: 80vh; width: 100%; }
        .info { padding: 10px; background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="info">
        <h3>üêõ Debug GPS M√≥vil</h3>
        <div id="status">Cargando...</div>
        <button onclick="iniciarGPS()">üìç Iniciar GPS</button>
        <button onclick="crearMarcador()">üéØ Crear Marcador</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        let map = L.map('map').setView([-12.0464, -77.0428], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        let marcador = null;

        function actualizarEstado(mensaje) {
            document.getElementById('status').innerHTML = mensaje;
            console.log(mensaje);
        }

        function crearMarcador() {
            if (!marcador) {
                marcador = L.marker([-12.0464, -77.0428], {
                    icon: L.divIcon({
                        html: '<div style="background: blue; width: 50px; height: 50px; border-radius: 50%;">üåé</div>',
                        className: 'icono-usuario',
                        iconSize: [50, 50],
                        iconAnchor: [25, 25]
                    })
                }).addTo(map);
                actualizarEstado('‚úÖ Marcador creado en Lima');
            } else {
                actualizarEstado('‚ö†Ô∏è Marcador ya existe');
            }
        }

        function iniciarGPS() {
            actualizarEstado('üìç Solicitando GPS...');
            
            if (!navigator.geolocation) {
                actualizarEstado('‚ùå GPS no soportado');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    actualizarEstado(`‚úÖ GPS: ${lat}, ${lng}`);
                    
                    // Mover marcador a ubicaci√≥n real
                    if (marcador) {
                        marcador.setLatLng([lat, lng]);
                    } else {
                        crearMarcador();
                        marcador.setLatLng([lat, lng]);
                    }
                    
                    map.setView([lat, lng], 15);
                },
                function(error) {
                    actualizarEstado(`‚ùå Error GPS: ${error.message}`);
                }
            );
        }

        // Crear marcador autom√°ticamente al cargar
        setTimeout(crearMarcador, 1000);
    </script>
</body>
</html>